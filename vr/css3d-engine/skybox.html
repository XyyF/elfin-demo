<html>
  <head></head>
  <body>
    <div id="container"></div>
    <script src="./index.min.js"></script>
    <script>
      window.onload = function initCSS3D() {
        // 创建场景
        var s = new C3D.Stage();
        // 设置场景布局：宽高
        s.size(window.innerWidth, window.innerHeight).update();
        // 挂载元素
        document.getElementById('container').appendChild(s.el);

        // 创建单独控制立方体各面素材的Box立方体容器
        var skybox = new C3D.Skybox();
        // 设置容器大小、旋转中心点、容器各个面的素材
        skybox.size(954).position(0, 0, 0).material({
          front: { image: "images/front.jpg", size: '100% 100%' },
          back: { image: "images/back.jpg", size: '100% 100%' },
          left: { image: "images/left.jpg", size: '100% 100%' },
          right: { image: "images/right.jpg", size: '100% 100%' },
          up: { image: "images/up.jpg", size: '100% 100%' },
          down: { image: "images/down.jpg", size: '100% 100%' },
        }).update();
        s.addChild(skybox);

        // 设置摄像机角度
        function loop() {
          angleX += (curMouseX - lastMouseX + lastAngleX - angleX) * 0.3;
          angleY += (curMouseY - lastMouseY + lastAngleY - angleY) * 0.3;

          // 设置摄像机视角的旋转角度
          s.camera.rotation(angleY, -angleX, 0).updateT();
          requestAnimationFrame(loop);
        }
        loop();

        var lastMouseX = 0;
        var lastMouseY = 0;
        var curMouseX = 0;
        var curMouseY = 0;
        var lastAngleX = 0;
        var lastAngleY = 0;
        var angleX = 0;
        var angleY = 0;

        // 触碰滑动事件，计算视角的旋转
        document.addEventListener("mousedown", mouseDownHandler);
        document.addEventListener("mouseup", mouseUpHandler);

        function mouseDownHandler(evt) {
          lastMouseX = curMouseX = evt.pageX;
          lastMouseY = curMouseY = evt.pageY;
          lastAngleX = angleX;
          lastAngleY = angleY;

          document.addEventListener("mousemove", mouseMoveHandler);
        }

        function mouseMoveHandler(evt) {
          curMouseX = evt.pageX;
          curMouseY = evt.pageY;
        }

        function mouseUpHandler(evt) {
          curMouseX = evt.pageX;
          curMouseY = evt.pageY;

          document.removeEventListener("mousemove", mouseMoveHandler);
        }

        // 设置页面内热点
        initPoints();
        function initPoints() {
          // 热点方位
          var hotPoints = [
            {
              position: {
                x: 300,
                y: 0,
                z: -476,
              },
              detail: {
                "title": "信息点1",
              },
            },
            {
              position: {
                x: 300,
                y: 0,
                z: 476,
              },
              detail: {
                "title": "信息点2",
              },
            },
          ];
          for (var i = 0; i < hotPoints.length; i++) {
            // 创建一个平面场景
            var _p = new C3D.Plane();

            _p.size(200, 200).position(hotPoints[i].position.x, hotPoints[i].position.y, hotPoints[i].position.z).material({
              image: "images/hot.png",
              size: '100% 100%',
              repeat: 'no-repeat',
              bothsides: true, // 注意这个两面贴图的属性
            }).update();
            s.addChild(_p);

            _p.el.detail = hotPoints[i].detail;
            _p.on('click', function (e) {
              window.alert(`点击热点区域: ${e.target.detail.title}`);
            });
          }
        }
      }
    </script>
  </body>
</html>